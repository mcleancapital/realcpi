<!DOCTYPE html>
<html lang="en">
<head>
    <title>TSA Checkpoint Passenger Volume</title>
    <style>
        canvas {
            display: block;
            margin: 0 auto;
            max-width: 100%;
        }
    </style>
    <!-- Import Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Import XLSX for Excel file parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <div>
        <h1>TSA Checkpoint Passenger Volume</h1>
    </div>
    <div>
        <canvas id="chartCanvas"></canvas>
    </div>

    <script>
        async function fetchExcelFile() {
            try {
                // Fetch Excel file from GitHub
                const response = await fetch(
                    'https://raw.githubusercontent.com/mcleancapital/realcpi/main/data/tsa_passenger_data.xlsx'
                );

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const arrayBuffer = await response.arrayBuffer();

                // Parse Excel file
                const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                const sheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[sheetName];
                const data = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

                const dates = [];
                const values = [];
                for (let i = 1; i < data.length; i++) {
                    if (data[i][0] && data[i][1]) {
                        dates.push(data[i][0]); // Column A (Date)
                        values.push(data[i][1]); // Column B (Passenger Volume)
                    }
                }

                return { dates, values };
            } catch (error) {
                console.error('Error fetching or parsing Excel file:', error);
                return { dates: [], values: [] };
            }
        }

        async function drawChart() {
            const { dates, values } = await fetchExcelFile();

            if (dates.length === 0 || values.length === 0) {
                console.error('No data available for the chart.');
                return;
            }

            const ctx = document.getElementById('chartCanvas').getContext('2d');

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Passenger Volume',
                        data: values,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 2,
                        fill: false,
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            type: 'category',
                            title: {
                                display: true,
                                text: 'Date'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Passenger Volume'
                            }
                        }
                    }
                }
            });
        }

        drawChart();
    </script>
</body>
</html>
